// @font-face declaration
//
// @param {String} $family - List to search in
// @param {String} $file - The filename
// @param {String} $base-path - Directory where the font is stored
// @param {Number} $weight (400) - CSS font-weight
// @param {String} $style (normal) - CSS font-style
//
// @outputs a @font-face declaration

@mixin guss-at-font-face(
    $family,
    $filename,
    $path,
    $weight: 400,
    $style: 'normal',
    $url: $guss-webfonts-base-url
) {
    @at-root {
        @font-face {
            font-family: $family;
            src: url('#{$url + $path + $filename}.eot'); // IE9 Compat Modes
            src: url('#{$url + $path + $filename}.eot?#iefix') format('embedded-opentype'), // IE6-IE8
                 url('#{$url + $path + $filename}.woff') format('woff'), // Modern Browsers
                 url('#{$url + $path + $filename}.ttf') format('truetype'), // Safari, Android, iOS
                 url('#{$url + $path + $filename}.svg##{str-remove-white-space($family)}') format('svg'); // Legacy iOS
            font-weight: $weight;
            font-style: unquote($style);
            font-stretch: normal;
        }
    }
}


// @font-face declaration for Guss webfonts
//
// @requires $guss-webfonts
// @requires $guss-font-weights
//
// @param {Number} $font-family - ID of the font in $guss-webfonts
// @param {Map} $properties - weight (member of $guss-font-weights), style (normal | italic)
// @param {Map} $overrides - weight (member of $guss-font-weights), style (normal | italic)
//
// @outputs a @font-face declaration

@mixin guss-webfonts-single-declaration(
    $font-family,
    $properties: (weight: 'regular', style: 'normal'),
    $overrides: (weight: false, style: false)
) {
    $font: map-get($guss-webfonts, $font-family);
    $font-weight-override: map-get($overrides, weight);
    $font-style-override: map-get($overrides, style);

    $font-filename: compose-webfont-filename($font-family, map-get($properties, weight), map-get($properties, style));
    $full-path: compose-webfont-path($font-family);
    $font-weight: guss-font-weight(if($font-weight-override, $font-weight-override, map-get($properties, weight)));
    $font-style: if($font-style-override, $font-style-override, map-get($properties, style));

    @include guss-at-font-face(
        $family: $font-family,
        $filename: $font-filename,
        $path: $full-path,
        $weight: $font-weight,
        $style: $font-style
    );
}


// @font-face declaration for multiple Guss webfonts
//
// @requires $guss-webfonts
//
// @param {String | List | Map} $include - Fonts to output
// @param {Map} $fonts ($guss-webfonts) - Font registry
//
// @outputs one or multiple @font-face declaration

@mixin guss-webfonts($fonts: $guss-webfonts, $registry: $guss-webfonts) {
    @if type-of($fonts) == string {
        @each $properties in map-get($registry, $fonts) {
            @include guss-webfonts-single-declaration($fonts, $properties);
        }
    } @else {
        @if type-of($fonts) == list {
            @each $font in $fonts {
                @include guss-webfonts($font);
            }
        } @else {
            @each $font-family, $font-property-sets in $fonts {
                @each $properties in $font-property-sets {
                    @if map-has-key($properties, use-as) {
                        @include guss-webfonts-single-declaration($font-family, $properties, map-get($properties, use-as));
                    } @else {
                        @include guss-webfonts-single-declaration($font-family, $properties);
                    }
                }
            }
        }
    }
}
